import{r as n,m as R,n as Y,j as e,t as B,A as G,v as N,F as E,p as J,q as K,w as Q}from"./index-PY5ovYXI.js";const k={hidden:{opacity:0},visible:{opacity:1,transition:{ease:"easeIn",duration:.3}},exit:{opacity:0,transition:{ease:"easeIn",duration:.3}}},X=()=>{const[C,f]=n.useState({username:"",email:"",password:""}),[S,m]=n.useState(!1),[D,w]=n.useState(!1),[x,P]=n.useState(!1),[L,j]=n.useState(!1),[z,y]=n.useState(!1),[A,o]=n.useState(!1),[I,b]=n.useState({day:null,month:null,year:null}),{userDataLoading:O,userData:s,fetchData:U,toastHandler:l,userError:v,setIsLoggedIn:h,authUrl:p}=n.useContext(R),{username:c,email:d,password:r}=C,{day:T,month:F,year:$}=I,u=Y();function g(t,a){t&&a!==void 0&&f(i=>({...i,[t]:a}))}n.useEffect(()=>{if(s&&s.date){const t=new Date(s.date),a=t.getFullYear(),i=t.getMonth()+1,M=t.getDate();b({day:M,month:i,year:a})}else b({day:null,month:null,year:null})},[s]);async function _(t){if(t.preventDefault(),c.length<3&&d.length<3&&r.length<3){l(!1,"At least one field must have 3+ characters.");return}try{w(!0);const a=await fetch(`${p}/auth/edit-details`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:c.length>0?c:null,email:d.length>0?d:null,password:r.length>0?r:null})});if(a.status===401)u("/login"),h(!1);else if(a.ok){const i=await a.json();m(!1),f({username:"",password:"",email:""}),U(),l(!0,i.msg||"User details updated successfully")}else{const{error:i}=await a.json();throw new Error(i.msg||"Something went wrong. Please try again later.")}}catch(a){console.error(a),l(!1,a.message||"Something went wrong. Please try again later.")}finally{w(!1)}}async function H(){try{y(!0);const t=await fetch(`${p}/auth/delete-account`,{method:"DELETE",credentials:"include"});if(t.status===401)u("/login"),h(!1),o(!1);else if(t.ok){const a=await t.json();u("/login"),h(!1),o(!1),l(!0,a.msg||"User account deleted successfully")}else{const{error:a}=await t.json();throw new Error(a.msg||"Something went wrong. Please try again later.")}}catch(t){console.error(t),l(!1,t.message||"Something went wrong. Please try again later.")}finally{y(!1)}}async function V(){if(!s||!s._id){l(!1,"User not found");return}try{j(!0);const t=await fetch(`${p}/auth/generate-verification-otp/${s._id}`,{method:"POST",credentials:"include"});if(t.ok){const a=await t.json();u(`/verify-otp/${s._id}?redirects=${encodeURIComponent("/user")}`),l(!0,a.msg||"OTP sent successfully")}else{const{error:a}=await t.json();throw new Error(a.msg||"Something went wrong. Please try again later.")}}catch(t){console.error(t),l(!1,t.message||"Something went wrong. Please try again later.")}finally{j(!1)}}function q(){window.location.reload()}return O?e.jsx(e.Fragment,{children:e.jsx(B,{})}):v?e.jsxs("section",{className:"w-full px-[2.5%] flex flex-col  max-h-[1300px] items-center justify-center gap-4 h-dvh min-h-[500px] ",children:[e.jsx("h1",{className:"text-xl font-[900] text-center w-full  pt-8 text-white sm:text-4xl",children:"Something went wrong"}),e.jsx("p",{className:"text-center text-white",children:v}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("button",{className:"button2 text-lg ",id:"active",onClick:q,children:"Click to refresh"})})]}):e.jsx("main",{className:"w-full min-h-dvh text-white pt-[150px] px-5half pb-10 flex flex-col gap-10 items-center   ",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"flex flex-col gap-4 items-center",children:[" ",e.jsx("h2",{className:"text-3xl font-black font-cinzel",children:"User Details"}),e.jsxs("ul",{className:"flex gap-2 flex-col",children:[e.jsxs("li",{children:["Username: ",s.username]}),e.jsxs("li",{children:["Email: ",s.email]}),e.jsxs("li",{children:["Account creation date: ",T,"-",F,"-",$]}),e.jsxs("li",{className:"flex items-center",children:[" Email is ",s.verification.verified===!1?"not":""," verified ",s.verification.verified===!1&&e.jsxs("button",{className:"ml-2 button flex items-center justify-center",onClick:V,children:["Verify email"," ",L&&e.jsx("div",{className:"loader ml-1",id:"loader"})]})]})]}),e.jsx("button",{className:"button2",onClick:()=>m(!0),children:"Edit details"})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-center text-3xl font-black font-cinzel",children:"Bookmarks"}),e.jsx("p",{className:"text-center",children:"Currently  unavailable"})]}),e.jsx(G,{children:S&&e.jsxs(N.section,{variants:k,initial:"hidden",animate:"visible",exit:"exit",className:"w-full fixed top-0 left-0 px-5half items-center flex-col gap-6 blurred3 z-[300] flex  justify-center  min-h-dvh",children:[e.jsxs("form",{className:"w-full max-w-[400px]  shadow-lg text-white  bg-black  rounded-md flex flex-col gap-6 p-4",onSubmit:_,children:[e.jsx("div",{className:"flex items-center flex-col gap-2 *:text-center",children:e.jsxs("h3",{className:"font-cinzel text-2xl font-black",children:[" ","Enter details to be changed"]})}),e.jsx("input",{type:"text",name:"username",onChange:({target:t})=>g("username",t.value),value:c,className:"w-full outline-none  bg-transparent border-b  placeholder:text-base text-white placeholder:italic  placeholder:font-cinzel  font-medium text-lg ",placeholder:"Enter new username"}),e.jsx("input",{type:"text",name:"email",onChange:({target:t})=>g("email",t.value),value:d,className:"w-full outline-none  bg-transparent border-b  placeholder:text-base text-white placeholder:italic  placeholder:font-cinzel  font-medium text-lg ",placeholder:"Enter new email"}),e.jsxs("span",{className:"w-full relative",children:[e.jsx("input",{onChange:({target:t})=>g("password",t.value),name:"password",type:x?"text":"password",className:"w-full outline-none  bg-transparent border-b  pr-[35px] placeholder:text-base text-white placeholder:italic  placeholder:font-cinzel  font-medium text-lg ",placeholder:"Enter new password",value:r}),r.length>0&&e.jsx(E,{icon:x?K:J,className:"w-[20px] aspect-square cursor-pointer flex items-center justify-center absolute right-0 top-2/4  translate-y-[-50%]",onClick:()=>{P(!x)}})]}),e.jsxs("button",{type:"submit",className:" button flex items-center justify-center",children:["Edit details",D&&e.jsx("div",{className:"loader ml-1",id:"loader"})," "]})]}),e.jsxs("button",{onClick:()=>{m(!1),f({username:"",password:"",email:""})},className:"text-sm text-white flex items-center justify-center",children:[e.jsx(E,{icon:Q,className:"mr-2"})," Go back"]})]},"modal")}),e.jsx("button",{className:" button flex items-center justify-center",onClick:()=>o(!0),children:"Delete account"}),A&&e.jsx(N.section,{variants:k,initial:"hidden",animate:"visible",exit:"exit",className:"w-full fixed top-0 left-0 items-center px-5half flex-col gap-6 blurred3 z-[300] flex  justify-center  min-h-dvh",children:e.jsxs("div",{className:"w-full max-w-[400px]  shadow-lg text-white  bg-black  rounded-md flex flex-col gap-4 p-4",children:[e.jsx("h3",{className:"font-cinzel text-2xl font-black",children:"Are you absolutely sure?"}),e.jsx("p",{className:"text-xs text-gray-300 ",children:"This action cannot be undone. This will permanently delete your account and remove your data from our servers."}),e.jsxs("span",{className:"flex gap-2 items-center flex-wrap justify-end",children:[e.jsx("button",{className:"button2",id:"delete_btn",onClick:()=>o(!1),children:"Cancel"}),e.jsxs("button",{className:"button2 active flex items-center",id:"delete_btn",onClick:H,children:["Continue",z&&e.jsx("div",{className:"loader ml-1",id:"loader"})]})]})]})},"modal")]}):e.jsx("h1",{className:"text-3xl font-black font-cinzel",children:"User details not found"})})};export{X as default};
